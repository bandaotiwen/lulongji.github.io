---
layout:     post
title:      简述数据库锁
subtitle:   简述数据库锁
date:       2019-02-18
author:     lulongji
header-img: img/post-bg-hacker.jpg
catalog: true
tags:
    - mysql
---


# 说明

做研发很多年，使用了各种类型的数据库，对于各种锁机制也只是浅表性的知道而已，花费一些时间总结一些，也弄清他们的实现原理和使用方式。

其实数据库锁的出现是为了处理并发的问题，因为数据库是多用户共享的资源，当多个用户同时对数据库并发操作时，会带来数据不一致的问题，所以，锁主要用于多用户环境下保证数据库完整性和一致性。

并发控制的主要采用的技术手段：乐观锁、悲观锁和时间戳。

# 锁分类

从程序的角度来看，锁主要分两类：

- 乐观锁
- 悲观锁

```乐观锁```
什么是乐观锁，顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以，不会上锁。但是在更新的时候会判断一下在此期间别人有没有更新这个数据，可以使用版本号等机制。

乐观锁适用于多读的应用类型，这样可以提高吞吐量。

```悲观锁```
顾名思义，很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人拿这个数据就会block（阻塞），直到它拿锁。

悲观锁按使用性质划分：

- 共享锁（Share Lock）
- 排他锁（Exclusive Lock）
- 更新锁 (Update Lock)

悲观锁按作用范围划分为：

- 行锁
- 表锁

### 共享锁（Share Lock） (s)

共享锁指的就是对于多个不同的事务，对同一个资源共享同一个锁。```相当于对于同一把门，它拥有多个钥匙一样。```

### 排他锁（Exclusive Lock） (x)

排它锁与共享锁相对应，就是指对于多个不同的事务，对同一个资源只能有一把锁。

### 更新锁 (Update Lock) (u)

用来预定要对此页施加X锁，它允许其他事务读，但不允许再施加U锁或X锁；当被读取的页将要被更新时，则升级为X锁；U锁一直到事务结束时才能被释放。

### 行锁

行锁，由字面意思理解，就是给某一行加上锁，也就是一条记录加上锁。

比如之前演示的共享锁语句：

    SELECT * from city where id = "1"  lock in share mode; 

由于对于city表中,id字段为主键，就也相当于索引。执行加锁时，会将id这个索引为1的记录加上锁，那么这个锁就是行锁。

### 表锁

表锁，和行锁相对应，给这个表加上锁。
